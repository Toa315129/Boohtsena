<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SENA PHOTOBOOTH</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#ffffff;
  --accent-blue:#bfeeff;
  --accent-yellow:#ffd54f;
  --accent-pink:#ffb6c1;
  --muted:#e6e9ee;
  --text:#223344;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--accent-blue);font-family:"Quicksand",sans-serif;color:var(--text);display:flex;align-items:center;justify-content:center;padding:18px}
.container{
  width:100%;max-width:960px;
  background:var(--bg);
  border-radius:20px;
  box-shadow:0 12px 30px rgba(0,0,0,0.12);
  padding:18px;
}

/* header */
.header{
  display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px;
  flex-wrap:wrap;
}
.header .brand{font-weight:700;font-size:18px}
.header .brand small{display:block;font-weight:500;font-size:12px;color:#666;text-transform:lowercase}

/* layout */
.main{
  display:flex;
  gap:18px;
  align-items:flex-start;
  justify-content:space-between;
  flex-wrap:wrap;
}

/* camera area */
.camera-wrap{
  flex:1 1 360px;
  min-width:300px;
  display:flex;flex-direction:column;align-items:center;gap:12px;
}
.preview{
  width:100%;
  border-radius:14px;
  overflow:hidden;
  background:var(--muted);
  border:6px solid #fff;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  position:relative;
  /* maintain tall preview (phone portrait) but responsive */
  aspect-ratio:3/4;
}
#video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1);display:block;}
.countdown{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:4.2rem;color:#fff;text-shadow:0 4px 12px rgba(0,0,0,0.5);pointer-events:none}
.flash{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;transition:opacity 0.18s}
.flash.show{opacity:0.85}

/* controls */
.controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:6px}
.btn{
  padding:10px 14px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;font-weight:700;cursor:pointer;
  box-shadow:0 4px 10px rgba(16,24,40,0.05);
}
.btn:disabled{opacity:0.55;cursor:not-allowed}
.shutter{
  width:84px;height:84px;border-radius:50%;background:linear-gradient(180deg,var(--accent-yellow),#f0b800);
  border:6px solid #fff;box-shadow:0 10px 20px rgba(0,0,0,0.12);
  display:inline-flex;align-items:center;justify-content:center;cursor:pointer;
}

/* thumbs */
.gallery{
  width:300px;min-width:260px;flex:0 0 300px;
  display:flex;flex-direction:column;gap:12px;align-items:center;
}
.thumbs{display:flex;gap:8px;width:100%;justify-content:space-between}
.thumb{width:32%;aspect-ratio:3/4;border-radius:10px;overflow:hidden;background:#fff;border:3px solid var(--muted);display:flex;align-items:center;justify-content:center}
.thumb img{width:100%;height:100%;object-fit:cover}

/* responsiveness: on wide (iPad landscape) make preview and gallery side-by-side larger */
@media(min-width:900px){
  .camera-wrap{flex:1 1 60%}
  .gallery{flex:0 0 36%;}
}

/* polaroid style note (png download will be generated on canvas) */
.note{font-size:13px;color:#666;text-align:center;margin-top:6px}
</style>
</head>
<body>
<div class="container" role="application" aria-label="SENA Photobooth">
  <div class="header">
    <div class="brand">PHOTO BOOTH <small>saphasena68</small></div>
    <div style="text-align:right;font-weight:700">SENA PHOTOBOOTH</div>
  </div>

  <div class="main">
    <div class="camera-wrap">
      <div class="preview" id="preview">
        <video id="video" autoplay playsinline></video>
        <div class="countdown" id="countdown"></div>
        <div class="flash" id="flash"></div>
      </div>

      <div class="controls" style="margin-top:10px">
        <div class="shutter" id="shutter" aria-label="Shutter button" title="ถ่ายภาพ"></div>
        <button class="btn" id="retake" disabled>ถ่ายใหม่</button>
        <button class="btn" id="switch">สลับกล้อง</button>
        <button class="btn" id="download" disabled>ดาวน์โหลด</button>
      </div>
      <div class="note">กดชัตเตอร์ครั้งเดียว → ถ่าย 3 ช็อต (3 วินาที) มีหยุด 1 วินาทีก่อนช็อตถัดไป</div>
    </div>

    <div class="gallery" aria-live="polite">
      <div style="font-weight:700">ตัวอย่าง 3 ภาพ</div>
      <div class="thumbs" id="thumbs">
        <div class="thumb" id="t1"><span style="opacity:.4">1</span></div>
        <div class="thumb" id="t2"><span style="opacity:.4">2</span></div>
        <div class="thumb" id="t3"><span style="opacity:.4">3</span></div>
      </div>
    </div>
  </div>
</div>

<!-- shutter sound -->
<audio id="snap" src="https://cdn.jsdelivr.net/gh/naptha/talkdemo/snap.mp3" preload="auto"></audio>

<script>
(async()=>{

// elements
const video = document.getElementById('video');
const shutter = document.getElementById('shutter');
const retakeBtn = document.getElementById('retake');
const switchBtn = document.getElementById('switch');
const downloadBtn = document.getElementById('download');
const countdownEl = document.getElementById('countdown');
const flash = document.getElementById('flash');
const snap = document.getElementById('snap');
const thumbs = [document.getElementById('t1'), document.getElementById('t2'), document.getElementById('t3')];

let stream = null;
let useFront = true;
let captures = [null,null,null];

// start camera
async function startCamera(){
  if(stream){stream.getTracks().forEach(t=>t.stop()); stream=null;}
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode: useFront ? 'user' : 'environment'}, audio:false});
    video.srcObject = stream;
    await video.play();
  }catch(e){
    alert('ไม่สามารถเปิดกล้องได้ กรุณาอนุญาตกล้องหรือใช้เบราว์เซอร์ที่รองรับ');
  }
}
await startCamera();

switchBtn.addEventListener('click', async ()=>{
  useFront = !useFront;
  await startCamera();
});

// helper capture frame (returns dataURL)
function captureFrame(){
  const vw = video.videoWidth, vh = video.videoHeight;
  // create canvas sized for video natural resolution
  const c = document.createElement('canvas');
  c.width = vw; c.height = vh;
  const ctx = c.getContext('2d');
  // mirror so preview and result match what user sees
  ctx.translate(c.width,0); ctx.scale(-1,1);
  ctx.drawImage(video,0,0,vw,vh);
  return c.toDataURL('image/png');
}

// show countdown
function showCount(num){
  countdownEl.textContent = num;
  countdownEl.style.opacity = 1;
}
function hideCount(){ countdownEl.textContent=''; countdownEl.style.opacity=1; }

// play flash + sound
function doFlash(){
  snap.currentTime = 0;
  snap.play().catch(()=>{});
  flash.classList.add('show');
  setTimeout(()=>flash.classList.remove('show'),170);
}

// utility: load image object from dataURL
function loadImage(src){
  return new Promise((res,rej)=>{
    const i = new Image();
    i.onload = ()=>res(i);
    i.onerror = rej;
    i.src = src;
  });
}

// core: take 3 shots in sequence
async function takeSequence(){
  // reset
  captures = [null,null,null];
  thumbs.forEach((t,i)=> t.innerHTML = `<span style="opacity:.4">${i+1}</span>`);
  retakeBtn.disabled = true;
  downloadBtn.disabled = true;
  shutter.style.pointerEvents='none';

  for(let i=0;i<3;i++){
    // countdown 3 seconds (showing 3..2..1)
    for(let s=3;s>=1;s--){
      showCount(s);
      await new Promise(r=>setTimeout(r,1000)); // 1s per countdown number
    }
    hideCount();

    // snapshot
    doFlash();
    const data = captureFrame();
    captures[i] = data;
    thumbs[i].innerHTML = `<img src="${data}" alt="shot ${i+1}">`;

    // wait 1 second pause before next shot (unless last)
    if(i < 2) await new Promise(r=>setTimeout(r,1000));
  }

  retakeBtn.disabled = false;
  downloadBtn.disabled = false;
  shutter.style.pointerEvents='';
}

// shutter handler
shutter.addEventListener('click', ()=>{
  takeSequence();
});

// retake
retakeBtn.addEventListener('click', ()=>{
  captures = [null,null,null];
  thumbs.forEach((t,i)=> t.innerHTML = `<span style="opacity:.4">${i+1}</span>`);
  downloadBtn.disabled = true;
});

// download: compose polaroid 4x6 canvas with clipping so images cannot overflow
downloadBtn.addEventListener('click', async ()=>{
  if(!captures[0]) return alert('ยังไม่ได้ถ่ายรูป');

  // canvas size: 1200x1800 px (~4x6)
  const W = 1200, H = 1800;
  const c = document.createElement('canvas'); c.width = W; c.height = H;
  const ctx = c.getContext('2d');

  // helper round rect
  function roundRect(ctx,x,y,w,h,r,fill,stroke){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
    if(fill) ctx.fill();
    if(stroke) ctx.stroke();
  }

  // background (minimal white with light blue outer border)
  ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle = '#bfeeff';
  roundRect(ctx,18,18,W-36,H-36,28,true,false);

  // top label area - SENA PHOTOBOOTH centered
  ctx.fillStyle = '#08324d';
  ctx.font = '700 56px Quicksand, sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('SENA PHOTOBOOTH', W/2, 78);

  // compute boxes for 3 vertical photos (with polaroid-like white frame inside)
  const marginX = 80;
  const innerW = W - marginX*2;
  const gap = 36;
  // reserve space top for label and some margin: topY
  const topY = 120;
  const availableH = H - topY - 120; // leave bottom padding for polaroid foot
  const boxH = Math.floor((availableH - gap*2)/3);
  const boxW = innerW;

  // style for image frames
  ctx.strokeStyle = '#ffffff';
  ctx.lineWidth = 12;

  // draw each image into a clipped rounded rect so it never overflows
  for(let i=0;i<3;i++){
    const y = topY + i*(boxH + gap);

    // background panel for each image (soft pastel)
    ctx.fillStyle = '#e9f6ff';
    roundRect(ctx, marginX, y, boxW, boxH, 22, true, false);

    // create clipping path
    ctx.save();
    roundRect(ctx, marginX+8, y+8, boxW-16, boxH-16, 16, false, false);
    ctx.clip();

    // draw image fitted (cover) WITHOUT overflowing - compute cover fit
    const data = captures[i];
    const img = await loadImage(data);
    // cover scale
    const scale = Math.max((boxW-16)/img.width, (boxH-16)/img.height);
    const iw = img.width*scale, ih = img.height*scale;
    const dx = marginX+8 + (boxW-16 - iw)/2;
    const dy = y+8 + (boxH-16 - ih)/2;
    ctx.drawImage(img, dx, dy, iw, ih);
    ctx.restore();

    // outer decorative stroke (white inner border)
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 8;
    roundRect(ctx, marginX+6, y+6, boxW-12, boxH-12, 18, false, true);
  }

  // bottom small tag and polaroid foot
  ctx.fillStyle = '#08324d';
  ctx.font = '600 20px Quicksand, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('@saphasena68', W/2, H - 48);

  // small stars (yellow) around edges (decorative) but not over images
  function drawStar(cx,cy,r,color){
    ctx.save(); ctx.fillStyle=color; ctx.beginPath();
    for(let k=0;k<5;k++){
      const a = (Math.PI*2*k)/5 - Math.PI/2;
      ctx.lineTo(cx + Math.cos(a)*r, cy + Math.sin(a)*r);
      const ia = a + Math.PI/5;
      ctx.lineTo(cx + Math.cos(ia)*r*0.5, cy + Math.sin(ia)*r*0.5);
    }
    ctx.closePath(); ctx.fill(); ctx.restore();
  }
  for(let i=0;i<18;i++){
    const r = Math.random()*12 + 6;
    const x = Math.random()*W;
    const y = Math.random()*H;
    // avoid overlapping the main image region
    if(x > marginX-40 && x < marginX+boxW+40 && y > topY-40 && y < topY + (boxH+gap)*3 + 40) continue;
    drawStar(x,y,r,'#ffd54f');
  }

  // download
  const a = document.createElement('a');
  a.href = c.toDataURL('image/png');
  a.download = 'SENA_PHOTOBOOTH_3shots.png';
  a.click();
});

// utility: load image
function loadImage(src){
  return new Promise((res,rej)=>{
    const i = new Image();
    i.onload = ()=>res(i);
    i.onerror = rej;
    i.src = src;
  });
}
})();
</script>
</body>
</html>
