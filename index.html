<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SENA PHOTOBOOTH</title>
<style>
  body{
    margin:0;
    background:#fdfdfd;
    font-family:'Segoe UI',sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
  }
  header{
    text-align:center;
    padding:1rem 0;
    font-size:1.8rem;
    font-weight:600;
    color:#222;
  }
  header .sub{font-size:.9rem;font-weight:400;color:#555;}
  .photo-container{
    position:relative;
    background:#fff;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 6px 16px rgba(0,0,0,.15);
    width:90vw;
    max-width:700px;
    aspect-ratio:3/4;
    margin:0 auto;
  }
  .photo-container video,
  .photo-container img{
    width:100%;height:100%;
    object-fit:cover;
    display:block;
  }
  .controls{
    margin-top:1.5rem;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:1rem;
  }
  button{
    background:#f0f0f0;
    border:none;
    border-radius:50px;
    padding:.75rem 1.5rem;
    font-size:1rem;
    cursor:pointer;
    transition:background .2s;
  }
  button:hover{background:#e0e0e0;}
  @media screen and (orientation:landscape){
    body{padding:1rem 3rem;}
    .photo-container{width:70vh;max-width:none;}
  }
</style>
</head>
<body>
<header>
  PHOTO BOOTH <span class="sub">saphasena68</span>
</header>

<div class="photo-container">
  <video id="camera" autoplay playsinline></video>
  <canvas id="canvas" hidden></canvas>
</div>

<div class="controls">
  <button id="capture">ถ่ายภาพ</button>
  <button id="retake">ถ่ายใหม่</button>
  <button id="switchCam">สลับกล้อง</button>
  <button id="download">ดาวน์โหลด</button>
</div>

<audio id="shutter" src="shutter.mp3" preload="auto"></audio>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('canvas');
const shutter = document.getElementById('shutter');
const captureBtn = document.getElementById('capture');
const retakeBtn = document.getElementById('retake');
const downloadBtn = document.getElementById('download');
const switchBtn = document.getElementById('switchCam');

let currentStream;
let useFront = true;
let capturedImages = [];

async function startCamera() {
  if (currentStream) currentStream.getTracks().forEach(t => t.stop());
  const constraints = { video: { facingMode: useFront ? 'user' : 'environment' } };
  currentStream = await navigator.mediaDevices.getUserMedia(constraints);
  video.srcObject = currentStream;
}
startCamera();

switchBtn.onclick = () => { useFront = !useFront; startCamera(); };

captureBtn.onclick = async () => {
  capturedImages = [];
  const ctx = canvas.getContext('2d');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  for (let i = 0; i < 3; i++) {
    shutter.play();
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    capturedImages.push(canvas.toDataURL('image/jpeg'));
    await new Promise(r => setTimeout(r, i === 2 ? 0 : 4000)); // 3วิ + พัก1วิ
  }

  // รวมภาพเป็นโพลารอยด์ 4x6
  const mergeCanvas = document.createElement('canvas');
  mergeCanvas.width = 1200;
  mergeCanvas.height = 1800;
  const mCtx = mergeCanvas.getContext('2d');
  mCtx.fillStyle = "#fff";
  mCtx.fillRect(0, 0, mergeCanvas.width, mergeCanvas.height);

  // หัวข้อ SENA PHOTOBOOTH
  mCtx.fillStyle = "#000";
  mCtx.font = "bold 70px sans-serif";
  mCtx.textAlign = "center";
  mCtx.fillText("SENA PHOTOBOOTH", mergeCanvas.width/2, 100);

  capturedImages.forEach((img, idx) => {
    const image = new Image();
    image.src = img;
    image.onload = () => {
      const h = 520;
      mCtx.drawImage(image, 60, 150 + idx * (h + 30), 1080, h);
      if (idx === 2) downloadBtn.dataset.ready = mergeCanvas.toDataURL('image/jpeg');
    };
  });
};

retakeBtn.onclick = () => { capturedImages = []; };

downloadBtn.onclick = () => {
  if (!downloadBtn.dataset.ready) return;
  const a = document.createElement('a');
  a.href = downloadBtn.dataset.ready;
  a.download = 'sena_photobooth.jpg';
  a.click();
};
</script>
</body>
</html>
